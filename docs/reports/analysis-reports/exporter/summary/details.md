# Export Format & Algorithm Details

## Export Format Details

### CSV Export

- Simple tabular format
- Single sheet: segment timeline data
- Columns: Segment #, Mission ID, Status, Start/End times (UTC/Eastern/T+),
  Duration, Transport states, Impacted systems, Reasons, Metadata
- Generated from `_segment_rows()` DataFrame

### XLSX Export

- Multi-sheet workbook:
  1. **Summary**: Map image (750x500px), Timeline chart (850x300px), Summary
     table with color coding
  1. **Timeline**: Full segment rows (detailed version)
  1. **Advisories**: Timeline advisory events (if any)
  1. **Statistics**: Mission metrics (if any)
- Color coding: Green (NOMINAL), Yellow (DEGRADED), Red (CRITICAL)
- Images embedded as OpenpyxlImage objects
- Column widths optimized for readability

### PDF Export

- Landscape letter-size pages
- Content:
  1. Header with logo, mission name
  2. Statistics table
  3. Route map (6.5" x 4.3") with color-coded segments, POI markers, legend
  4. Transport timeline chart (7" x 2.3")
  5. Detailed timeline table (paginated as needed)
- Advanced styling: Row alternation, per-column coloring, safety-of-flight
  detection
- Generated using reportlab.platypus

### PPTX Export

- Multi-slide presentation:
  1. Route map slide (9"W x 6.5"H)
  2. Timeline table slides (paginated, 10 rows per slide, min 3 on last slide)
- Color-coded rows: Red (CRITICAL, 2+ bad systems), Yellow
  (DEGRADED/WARNING/SOF), White (nominal)
- Generated using python-pptx
- Same pagination logic as PDF

### Combined Exports (package_exporter.py)

**Combined CSV:**

- Single file with all legs concatenated
- Leg boundary markers (LEG START, LEG END)
- Includes segments and advisories for each leg

**Combined XLSX:**

- Mission Summary sheet (overview + leg index)
- Imported sheets from each leg's XLSX (with L{idx} prefix)
- One sheet per leg's summary, timeline, advisories, statistics

**Combined PDF:**

- Cover page (mission overview, table of contents)
- Per-leg sections with dividers
- Summary page
- Generated by merging individual leg PDFs

**Combined PPTX:**

- Title slide (mission name, leg count)
- Per-leg slides (reuses `generate_pptx_export()` logic)
- Native generation (not combining individual leg PPTXs)

---

## Key Algorithms & Techniques

### Timestamp Formatting

Three parallel formats for mission times:

- **UTC:** "2024-12-03 14:30Z"
- **Eastern:** "2024-12-03 09:30EST" (DST-aware)
- **Mission Relative:** "T+02:30" (hours:minutes from mission start)

### Map Generation (4K, 3840x2160 @ 300 DPI)

**Features:**

- Cartopy map projections with dynamic centering
- International Date Line (IDL) crossing handling (normalizes to 0-360 space)
- Bounds calculation with aspect ratio matching to canvas
- Color-coded route segments based on timeline status
- POI markers: Departure (green), Arrival (red), Waypoints (blue diamond)
- Satellite transitions and AAR blocks as POIs
- Legend inset with status colors

**IDL Handling:**

- Detects lon jumps > 180 degrees
- Centers projection on route midpoint
- Normalizes coordinates to 0-360 range
- Splits segments at boundaries for proper rendering

### Status Color Mapping

- **Nominal** (green #2ecc71) - All systems operational
- **Degraded** (yellow #f1c40f) - Some systems offline or warning
- **Critical** (red #e74c3c) - 2+ bad systems or safety-of-flight issue
- **Unknown** (gray #95a5a6) - No timeline data

### Safety-of-Flight Detection

- Checked via reason strings: "safety-of-flight" or "aar"
- Overrides status display to "SOF" in tables
- Applied to both PDF and PPTX rendering

### Table Pagination (PPTX)

- 10 rows per slide maximum
- Minimum 3 rows on final slide
- If last chunk < 3 rows, redistributes items between last two chunks
- Ensures readable tables on fixed-size slides

---

## Performance Characteristics

### Map Generation

- ~5-15 seconds for typical routes (depends on cartopy complexity)
- Cartopy coastline data: ~25 MB on disk
- PNG output: 2-5 MB per map (4K resolution, high quality)

### Chart Generation

- ~1-2 seconds per timeline
- PNG output: 100-300 KB per chart

### XLSX Generation

- Per-leg: ~5-10 seconds (includes map/chart embedding)
- Combined multi-leg: ~30-60 seconds (N Ã— leg time)
- Image scaling and embedding: most expensive operation

### PDF Generation

- Per-leg: ~3-8 seconds
- Combined multi-leg: ~20-50 seconds (PDF merging is fast)

### ZIP Archive

- Per-leg exports: ~5-15 seconds per leg
- Combined exports: ~30-60 seconds
- POI/KML archival: negligible (<100 ms)
- Archive creation (zip compression): 5-10 seconds

### Total End-to-End

- Single leg (all 4 formats): ~30-50 seconds
- 3-leg mission (all formats, combined + per-leg): ~3-5 minutes
- Output size: ~15-30 MB (depending on map resolution)
